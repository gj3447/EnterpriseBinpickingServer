<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        img { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>
    <img id="stream" alt="{{ title }} Stream">

    <script>
        const streamId = "{{ stream_id }}";
        const imgElement = document.getElementById('stream');
        
        const wsPath = `/ws/${streamId}`;
        const socket = new WebSocket(`ws://${window.location.host}${wsPath}`);

        socket.onopen = () => {
            console.log(`WebSocket connected to ${wsPath}`);
        };

        socket.onmessage = (event) => {
            if (event.data instanceof Blob) {
                if (imgElement.src) {
                    URL.revokeObjectURL(imgElement.src);
                }
                const typedBlob = new Blob([event.data], { type: 'image/jpeg' });
                const imageUrl = URL.createObjectURL(typedBlob);
                imgElement.src = imageUrl;
            }
        };

        socket.onclose = (event) => {
            console.log(`WebSocket disconnected from ${wsPath}: ${event.code}`);
            imgElement.src = ""; // Clear image on disconnect
        };
        
        socket.onerror = (error) => {
            console.error(`WebSocket error on ${wsPath}:`, error);
        }
    </script>
</body>
</html>
